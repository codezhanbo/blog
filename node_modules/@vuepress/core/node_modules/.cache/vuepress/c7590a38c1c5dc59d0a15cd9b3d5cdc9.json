{"remainingRequest":"C:\\Users\\zhanb\\Desktop\\vuepress-theme-reco\\my-blog\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!C:\\Users\\zhanb\\Desktop\\vuepress-theme-reco\\my-blog\\node_modules\\@vssue\\api-github-v4\\lib\\index.js","dependencies":[{"path":"C:\\Users\\zhanb\\Desktop\\vuepress-theme-reco\\my-blog\\node_modules\\@vssue\\api-github-v4\\lib\\index.js","mtime":1589006623121},{"path":"C:\\Users\\zhanb\\Desktop\\vuepress-theme-reco\\my-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1588985061160},{"path":"C:\\Users\\zhanb\\Desktop\\vuepress-theme-reco\\my-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":1588985061023}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZXZlcnNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2giOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkM6L1VzZXJzL3poYW5iL0Rlc2t0b3AvdnVlcHJlc3MtdGhlbWUtcmVjby9teS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L1VzZXJzL3poYW5iL0Rlc2t0b3AvdnVlcHJlc3MtdGhlbWUtcmVjby9teS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy96aGFuYi9EZXNrdG9wL3Z1ZXByZXNzLXRoZW1lLXJlY28vbXktYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6L1VzZXJzL3poYW5iL0Rlc2t0b3AvdnVlcHJlc3MtdGhlbWUtcmVjby9teS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGJ1aWxkVVJMLCBjb25jYXRVUkwsIGdldENsZWFuVVJMLCBwYXJzZVF1ZXJ5IH0gZnJvbSAnQHZzc3VlL3V0aWxzJzsKaW1wb3J0IHsgbm9ybWFsaXplVXNlciwgbm9ybWFsaXplSXNzdWUsIG5vcm1hbGl6ZUNvbW1lbnQsIG5vcm1hbGl6ZVJlYWN0aW9ucywgbWFwUmVhY3Rpb25OYW1lIH0gZnJvbSAnLi91dGlscyc7Ci8qKgogKiBHaXRodWIgR3JhcGhRTCBBUEkgdjQKICoKICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0LwogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvZXhwbG9yZXIvCiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS9hcHBzL2J1aWxkaW5nLW9hdXRoLWFwcHMvCiAqLwoKdmFyIEdpdGh1YlY0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBHaXRodWJWNChfcmVmKSB7CiAgICB2YXIgX3JlZiRiYXNlVVJMID0gX3JlZi5iYXNlVVJMLAogICAgICAgIGJhc2VVUkwgPSBfcmVmJGJhc2VVUkwgPT09IHZvaWQgMCA/ICdodHRwczovL2dpdGh1Yi5jb20nIDogX3JlZiRiYXNlVVJMLAogICAgICAgIG93bmVyID0gX3JlZi5vd25lciwKICAgICAgICByZXBvID0gX3JlZi5yZXBvLAogICAgICAgIGxhYmVscyA9IF9yZWYubGFiZWxzLAogICAgICAgIGNsaWVudElkID0gX3JlZi5jbGllbnRJZCwKICAgICAgICBjbGllbnRTZWNyZXQgPSBfcmVmLmNsaWVudFNlY3JldCwKICAgICAgICBzdGF0ZSA9IF9yZWYuc3RhdGUsCiAgICAgICAgcHJveHkgPSBfcmVmLnByb3h5OwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBHaXRodWJWNCk7CgogICAgaWYgKHR5cGVvZiBjbGllbnRTZWNyZXQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBwcm94eSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjbGllbnRTZWNyZXQgYW5kIHByb3h5IGlzIHJlcXVpcmVkIGZvciBHaXRIdWIgVjQnKTsKICAgIH0KCiAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMOwogICAgdGhpcy5vd25lciA9IG93bmVyOwogICAgdGhpcy5yZXBvID0gcmVwbzsKICAgIHRoaXMubGFiZWxzID0gbGFiZWxzOwogICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOwogICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLnByb3h5ID0gcHJveHk7CiAgICB0aGlzLl9wYWdlSW5mbyA9IHsKICAgICAgcGFnZTogMSwKICAgICAgc3RhcnRDdXJzb3I6IG51bGwsCiAgICAgIGVuZEN1cnNvcjogbnVsbCwKICAgICAgc29ydDogbnVsbCwKICAgICAgcGVyUGFnZTogbnVsbAogICAgfTsKICAgIHRoaXMuX2lzc3VlTm9kZUlkID0gbnVsbDsKICAgIHRoaXMuJGh0dHAgPSBheGlvcy5jcmVhdGUoewogICAgICBiYXNlVVJMOiBiYXNlVVJMID09PSAnaHR0cHM6Ly9naXRodWIuY29tJyA/ICdodHRwczovL2FwaS5naXRodWIuY29tJyA6IGNvbmNhdFVSTChiYXNlVVJMLCAnYXBpJyksCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4kaHR0cC5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICBpZiAocmVzcG9uc2UuZGF0YS5lcnJvcikgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXNwb25zZS5kYXRhLmVycm9yX2Rlc2NyaXB0aW9uKTsKICAgICAgfQoKICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZXJyb3JzKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlLmRhdGEuZXJyb3JzWzBdLm1lc3NhZ2UpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9KTsKICB9CiAgLyoqCiAgICogVGhlIHBsYXRmb3JtIGFwaSBpbmZvCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoR2l0aHViVjQsIFt7CiAgICBrZXk6ICJyZWRpcmVjdEF1dGgiLAoKICAgIC8qKgogICAgICogUmVkaXJlY3QgdG8gdGhlIGF1dGhvcml6YXRpb24gcGFnZSBvZiBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzL2F1dGhvcml6aW5nLW9hdXRoLWFwcHMvIzEtcmVxdWVzdC1hLXVzZXJzLWdpdGh1Yi1pZGVudGl0eQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVkaXJlY3RBdXRoKCkgewogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGJ1aWxkVVJMKGNvbmNhdFVSTCh0aGlzLmJhc2VVUkwsICdsb2dpbi9vYXV0aC9hdXRob3JpemUnKSwgewogICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICByZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICAgIHNjb3BlOiAncHVibGljX3JlcG8nLAogICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBIYW5kbGUgYXV0aG9yaXphdGlvbi4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzL2F1dGhvcml6aW5nLW9hdXRoLWFwcHMvCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIElmIHRoZSBgY29kZWAgYW5kIGBzdGF0ZWAgZXhpc3QgaW4gdGhlIHF1ZXJ5LCBhbmQgdGhlIGBzdGF0ZWAgbWF0Y2hlcywgcmVtb3ZlIHRoZW0gZnJvbSBxdWVyeSwgYW5kIHRyeSB0byBnZXQgdGhlIGFjY2VzcyB0b2tlbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVBdXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaGFuZGxlQXV0aCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgcXVlcnksIGNvZGUsIHJlcGxhY2VVUkwsIGFjY2Vzc1Rva2VuOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gcGFyc2VRdWVyeSh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKCiAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIShxdWVyeS5zdGF0ZSAhPT0gdGhpcy5zdGF0ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjb2RlID0gcXVlcnkuY29kZTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5jb2RlOwogICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5LnN0YXRlOwogICAgICAgICAgICAgICAgcmVwbGFjZVVSTCA9IGJ1aWxkVVJMKGdldENsZWFuVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSwgcXVlcnkpICsgd2luZG93LmxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgJycsIHJlcGxhY2VVUkwpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWNjZXNzVG9rZW4oewogICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGFjY2Vzc1Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZUF1dGgoKSB7CiAgICAgICAgcmV0dXJuIF9oYW5kbGVBdXRoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoYW5kbGVBdXRoOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCB1c2VyIGFjY2VzcyB0b2tlbiB2aWEgYGNvZGVgCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLyMyLXVzZXJzLWFyZS1yZWRpcmVjdGVkLWJhY2stdG8teW91ci1zaXRlLWJ5LWdpdGh1YgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEFjY2Vzc1Rva2VuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0QWNjZXNzVG9rZW4gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKF9yZWYyKSB7CiAgICAgICAgdmFyIGNvZGUsIG9yaWdpbmFsVVJMLCBwcm94eVVSTCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29kZSA9IF9yZWYyLmNvZGU7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBhY2Nlc3NfdG9rZW4gYXBpIGRvZXMgbm90IHN1cHBvcnQgY29ycwogICAgICAgICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vaXNhYWNzL2dpdGh1Yi9pc3N1ZXMvMzMwCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIG9yaWdpbmFsVVJMID0gY29uY2F0VVJMKHRoaXMuYmFzZVVSTCwgJ2xvZ2luL29hdXRoL2FjY2Vzc190b2tlbicpOwogICAgICAgICAgICAgICAgcHJveHlVUkwgPSB0eXBlb2YgdGhpcy5wcm94eSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMucHJveHkob3JpZ2luYWxVUkwpIDogdGhpcy5wcm94eTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QocHJveHlVUkwsIHsKICAgICAgICAgICAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLAogICAgICAgICAgICAgICAgICBjbGllbnRfc2VjcmV0OiB0aGlzLmNsaWVudFNlY3JldCwKICAgICAgICAgICAgICAgICAgY29kZTogY29kZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvcy5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGRhdGEuYWNjZXNzX3Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oX3gpIHsKICAgICAgICByZXR1cm4gX2dldEFjY2Vzc1Rva2VuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRBY2Nlc3NUb2tlbjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxvZ2dlZC1pbiB1c2VyIHdpdGggYWNjZXNzIHRva2VuLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9xdWVyeS8gdmlld2VyCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvb2JqZWN0L3VzZXIvCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0VXNlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldFVzZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9yZWYzKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMy5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoJ2dyYXBocWwnLCB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAicXVlcnkgZ2V0VXNlciB7XG4gIHZpZXdlciB7XG4gICAgbG9naW5cbiAgICBhdmF0YXJVcmxcbiAgICB1cmxcbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczIgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplVXNlcihkYXRhLmRhdGEudmlld2VyKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFVzZXIoX3gyKSB7CiAgICAgICAgcmV0dXJuIF9nZXRVc2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRVc2VyOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCBpc3N1ZSBvZiB0aGlzIHBhZ2UgYWNjb3JkaW5nIHRvIHRoZSBpc3N1ZSBpZCBvciB0aGUgaXNzdWUgdGl0bGUKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvb2JqZWN0L3JlcG9zaXRvcnkvCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvb2JqZWN0L2lzc3VlY29ubmVjdGlvbi8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9vYmplY3QvaXNzdWUvCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIFRoZSBJc3N1ZUNvbm5lY3Rpb24gZG9lcyBub3QgaGF2ZSB0aXRsZSBmaWx0ZXIgZm9yIG5vdywgYW5kIHRoZSBudW1iZXIgb2YgcmVzdWx0cyBpcyBsaW1pdGVkIHRvIDEwMC4KICAgICAqIEZvciBub3csIGlmIGlzc3VlcyB3aXRoIHRoZSBsYWJlbHMgYXJlIG1vcmUgdGhhbiAxMDAsIHdlIGhhdmUgdG8gcmVxdWVzdCB0aGUgbmV4dCBwYWdlKG5vdCBpbXBsZW1lbnRlZCB5ZXQpLgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWY0KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBpc3N1ZVRpdGxlLCBvcHRpb25zLCBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLCBkYXRhLCBxdWVyeSwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNCwgX2RhdGEsIGlzc3VlOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNC5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWY0Lmlzc3VlSWQsIGlzc3VlVGl0bGUgPSBfcmVmNC5pc3N1ZVRpdGxlOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwoKICAgICAgICAgICAgICAgIGlmIChhY2Nlc3NUb2tlbikgewogICAgICAgICAgICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghaXNzdWVJZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICBxdWVyeTogInF1ZXJ5IGdldElzc3VlQnlJZCB7XG4gIHJlcG9zaXRvcnkob3duZXI6IFwiIi5jb25jYXQodGhpcy5vd25lciwgIlwiLCBuYW1lOiBcIiIpLmNvbmNhdCh0aGlzLnJlcG8sICJcIikge1xuICAgIGlzc3VlIChudW1iZXI6ICIpLmNvbmNhdChpc3N1ZUlkLCAiKSB7XG4gICAgICBpZFxuICAgICAgbnVtYmVyXG4gICAgICB0aXRsZVxuICAgICAgYm9keVxuICAgICAgdXJsXG4gICAgfVxuICB9XG59IikKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3MzID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zMy5kYXRhOwogICAgICAgICAgICAgICAgLy8gcG9zdENvbW1lbnQgbmVlZHMgaXNzdWUgTm9kZUlkLCBzbyB3ZSBzdG9yZSBpdCBpbnRlcm5hbGx5CiAgICAgICAgICAgICAgICB0aGlzLl9pc3N1ZU5vZGVJZCA9IGRhdGEuZGF0YS5yZXBvc2l0b3J5Lmlzc3VlLmlkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEuZGF0YS5yZXBvc2l0b3J5Lmlzc3VlKSk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDEzOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnQwID0gX2NvbnRleHQ0WyJjYXRjaCJdKDQpOwoKICAgICAgICAgICAgICAgIGlmICghKF9jb250ZXh0NC50MC5yZXNwb25zZSAmJiBfY29udGV4dDQudDAucmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIHRocm93IF9jb250ZXh0NC50MDsKCiAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gWyJcIiIuY29uY2F0KGlzc3VlVGl0bGUsICJcIiIpLCAiaW46dGl0bGUiLCAicmVwbzoiLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8pLCAiaXM6cHVibGljIl0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLmxhYmVscy5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAibGFiZWw6Ii5jb25jYXQobGFiZWwpOwogICAgICAgICAgICAgICAgfSkpKS5qb2luKCcgJyk7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAicXVlcnkgZ2V0SXNzdWVCeVRpdGxlKFxuICAkcXVlcnk6IFN0cmluZyFcbikge1xuICBzZWFyY2goXG4gICAgcXVlcnk6ICRxdWVyeVxuICAgIHR5cGU6IElTU1VFXG4gICAgZmlyc3Q6IDIwXG4gICAgKSB7XG4gICAgICBub2RlcyB7XG4gICAgICAuLi4gb24gSXNzdWUge1xuICAgICAgICBpZFxuICAgICAgICBudW1iZXJcbiAgICAgICAgdGl0bGVcbiAgICAgICAgYm9keVxuICAgICAgICB1cmxcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczQgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF9kYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zNC5kYXRhOwogICAgICAgICAgICAgICAgaXNzdWUgPSBfZGF0YS5kYXRhLnNlYXJjaC5ub2Rlcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRpdGxlID09PSBpc3N1ZVRpdGxlOwogICAgICAgICAgICAgICAgfSk7IC8vIHBvc3RDb21tZW50IG5lZWRzIGlzc3VlIE5vZGVJZCwgc28gd2Ugc3RvcmUgaXQgaW50ZXJuYWxseQoKICAgICAgICAgICAgICAgIGlmICghaXNzdWUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5faXNzdWVOb2RlSWQgPSBpc3N1ZS5pZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVJc3N1ZShpc3N1ZSkpOwoKICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzLCBbWzQsIDEzXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRJc3N1ZShfeDMpIHsKICAgICAgICByZXR1cm4gX2dldElzc3VlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRJc3N1ZTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgaXNzdWUKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vY3JlYXRlaXNzdWUvCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvaW5wdXRfb2JqZWN0L2NyZWF0ZWlzc3VlaW5wdXQvCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIENyZWF0aW5nIGlzc3VlIHJlcXVpcmVzIHJlcG9zaXRvcnlJZCwgd2hpY2ggc2hvdWxkIGJlIHJlcXVlc3RlZCBpbiBhbiBleHRyYSByZXF1ZXN0LgogICAgICogQ3JlYXRpbmcgaXNzdWUgd2l0aCBsYWJlbHMgcmVxdWlyZXMgbGFiZWxJZHMsIHdoaWNoIHNob3VsZCBiZSByZXF1ZXN0ZWQgaW4gYW4gZXh0cmEgcmVxdWVzdCwgb3IgY3JlYXRlIHRoZSBsYWJlbCBpZiBpdCBkb2VzIG5vdCBleGlzdC4KICAgICAqIEVuZHBvaW50cyBmb3IgY3JlYXRpbmcgbGFiZWxzIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZCBieSBHaXRIdWIgeWV0IChzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi9jcmVhdGVsYWJlbC8pCiAgICAgKgogICAgICogRm9yIHRoZXNlIHJlYXNvbnMsIGZhbGxiYWNrIHRvIHYzIGZvciBub3cKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0SXNzdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KF9yZWY1KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCB0aXRsZSwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNSwgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjUuYWNjZXNzVG9rZW4sIHRpdGxlID0gX3JlZjUudGl0bGUsIGNvbnRlbnQgPSBfcmVmNS5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3VlcyIpLCB7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICAgICAgYm9keTogY29udGVudCwKICAgICAgICAgICAgICAgICAgbGFiZWxzOiB0aGlzLmxhYmVscwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNSA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczUuZGF0YTsKICAgICAgICAgICAgICAgIC8vIGBodG1sX3VybGAgaW4gdjMKICAgICAgICAgICAgICAgIC8vIGB1cmxgIGluIHY0CiAgICAgICAgICAgICAgICBkYXRhLnVybCA9IGRhdGEuaHRtbF91cmw7IC8vIHBvc3RDb21tZW50IG5lZWRzIGlzc3VlIE5vZGVJZCwgc28gd2Ugc3RvcmUgaXQgaW50ZXJuYWxseQoKICAgICAgICAgICAgICAgIHRoaXMuX2lzc3VlTm9kZUlkID0gZGF0YS5ub2RlX2lkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdElzc3VlKF94NCkgewogICAgICAgIHJldHVybiBfcG9zdElzc3VlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IGNvbW1lbnRzIG9mIHRoaXMgcGFnZSBhY2NvcmRpbmcgdG8gdGhlIGlzc3VlIGlkCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L29iamVjdC9pc3N1ZWNvbW1lbnRjb25uZWN0aW9uLwogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBObyBvZmZzZXQgaW1wbGVtZW50ZWQsIHNvIGl0J3MgZGlmZmljdWx0IHRvIGltcGxlbWVudCBSRVNULWxpa2UgcGFnaW5hdGlvbgogICAgICogRm9yIG5vdywgd2UgdXNlIGFuIGludGVybmFsIGBfcGFnZUluZm9gIHZhciB0byBoYWNrIHRoYXQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb21tZW50cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldENvbW1lbnRzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNihfcmVmNikgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgaXNzdWVJZCwgX3JlZjYkcXVlcnksIF9yZWY2JHF1ZXJ5JHBhZ2UsIHBhZ2UsIF9yZWY2JHF1ZXJ5JHBlclBhZ2UsIHBlclBhZ2UsIF9yZWY2JHF1ZXJ5JHNvcnQsIHNvcnQsIG9wdGlvbnMsIF90aGlzJF9nZXRRdWVyeVBhcmFtcywgZmlyc3RPckxhc3QsIGFmdGVyT3JCZWZvcmUsIGN1cnNvciwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNiwgZGF0YSwgY29tbWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY2LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjYuaXNzdWVJZCwgX3JlZjYkcXVlcnkgPSBfcmVmNi5xdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY2JHF1ZXJ5ID0gX3JlZjYkcXVlcnkgPT09IHZvaWQgMCA/IHt9IDogX3JlZjYkcXVlcnk7CiAgICAgICAgICAgICAgICBfcmVmNiRxdWVyeSRwYWdlID0gX3JlZjYkcXVlcnkucGFnZSwgcGFnZSA9IF9yZWY2JHF1ZXJ5JHBhZ2UgPT09IHZvaWQgMCA/IDEgOiBfcmVmNiRxdWVyeSRwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlID0gX3JlZjYkcXVlcnkucGVyUGFnZSwgcGVyUGFnZSA9IF9yZWY2JHF1ZXJ5JHBlclBhZ2UgPT09IHZvaWQgMCA/IDEwIDogX3JlZjYkcXVlcnkkcGVyUGFnZSwgX3JlZjYkcXVlcnkkc29ydCA9IF9yZWY2JHF1ZXJ5LnNvcnQsIHNvcnQgPSBfcmVmNiRxdWVyeSRzb3J0ID09PSB2b2lkIDAgPyAnZGVzYycgOiBfcmVmNiRxdWVyeSRzb3J0OwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwoKICAgICAgICAgICAgICAgIGlmIChhY2Nlc3NUb2tlbikgewogICAgICAgICAgICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYWdlSW5mby5zb3J0ICE9PSBudWxsICYmIHNvcnQgIT09IHRoaXMuX3BhZ2VJbmZvLnNvcnQpIHsKICAgICAgICAgICAgICAgICAgcGFnZSA9IDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMkX2dldFF1ZXJ5UGFyYW1zID0gdGhpcy5fZ2V0UXVlcnlQYXJhbXMoewogICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLAogICAgICAgICAgICAgICAgICBzb3J0OiBzb3J0CiAgICAgICAgICAgICAgICB9KSwgZmlyc3RPckxhc3QgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMuZmlyc3RPckxhc3QsIGFmdGVyT3JCZWZvcmUgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMuYWZ0ZXJPckJlZm9yZSwgY3Vyc29yID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zLmN1cnNvcjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIG93bmVyOiB0aGlzLm93bmVyLAogICAgICAgICAgICAgICAgICAgIHJlcG86IHRoaXMucmVwbywKICAgICAgICAgICAgICAgICAgICBpc3N1ZUlkOiBpc3N1ZUlkLAogICAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJxdWVyeSBnZXRDb21tZW50cyhcbiAgJG93bmVyOiBTdHJpbmchXG4gICRyZXBvOiBTdHJpbmchXG4gICRpc3N1ZUlkOiBJbnQhXG4gICRwZXJQYWdlOiBJbnQhXG4pIHtcbiAgcmVwb3NpdG9yeShvd25lcjogJG93bmVyLCBuYW1lOiAkcmVwbykge1xuICAgIGlzc3VlKG51bWJlcjogJGlzc3VlSWQpIHtcbiAgICAgIGNvbW1lbnRzKFxuICAgICAgICAiLmNvbmNhdChmaXJzdE9yTGFzdCwgIjogJHBlclBhZ2VcbiAgICAgICAgIikuY29uY2F0KGFmdGVyT3JCZWZvcmUgPT09IG51bGwgPyAnJyA6ICIiLmNvbmNhdChhZnRlck9yQmVmb3JlLCAiOiBcIiIpLmNvbmNhdChjdXJzb3IsICJcIiIpLCAiXG4gICAgICApIHtcbiAgICAgICAgdG90YWxDb3VudFxuICAgICAgICBwYWdlSW5mbyB7XG4gICAgICAgICAgZW5kQ3Vyc29yXG4gICAgICAgICAgc3RhcnRDdXJzb3JcbiAgICAgICAgfVxuICAgICAgICBub2RlcyB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBib2R5XG4gICAgICAgICAgYm9keUhUTUxcbiAgICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgICB1cGRhdGVkQXRcbiAgICAgICAgICBhdXRob3Ige1xuICAgICAgICAgICAgYXZhdGFyVXJsXG4gICAgICAgICAgICBsb2dpblxuICAgICAgICAgICAgdXJsXG4gICAgICAgICAgfVxuICAgICAgICAgIHJlYWN0aW9uR3JvdXBzIHtcbiAgICAgICAgICAgIHVzZXJzIChmaXJzdDogMCkge1xuICAgICAgICAgICAgICB0b3RhbENvdW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250ZW50XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59IikKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M2ID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zNi5kYXRhOwogICAgICAgICAgICAgICAgY29tbWVudHMgPSBkYXRhLmRhdGEucmVwb3NpdG9yeS5pc3N1ZS5jb21tZW50czsKCiAgICAgICAgICAgICAgICBpZiAoc29ydCA9PT0gJ2Rlc2MnKSB7CiAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLm5vZGVzLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLl9wYWdlSW5mbyA9IHsKICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgICAgICAgICAgc3RhcnRDdXJzb3I6IGNvbW1lbnRzLnBhZ2VJbmZvLnN0YXJ0Q3Vyc29yLAogICAgICAgICAgICAgICAgICBlbmRDdXJzb3I6IGNvbW1lbnRzLnBhZ2VJbmZvLmVuZEN1cnNvciwKICAgICAgICAgICAgICAgICAgc29ydDogc29ydCwKICAgICAgICAgICAgICAgICAgcGVyUGFnZTogcGVyUGFnZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIGNvdW50OiBjb21tZW50cy50b3RhbENvdW50LAogICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLAogICAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlLAogICAgICAgICAgICAgICAgICBkYXRhOiBjb21tZW50cy5ub2Rlcy5tYXAobm9ybWFsaXplQ29tbWVudCkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0Q29tbWVudHMoX3g1KSB7CiAgICAgICAgcmV0dXJuIF9nZXRDb21tZW50cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Q29tbWVudHM7CiAgICB9KCkKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vYWRkY29tbWVudC8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9pbnB1dF9vYmplY3QvYWRkY29tbWVudGlucHV0LwogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KF9yZWY3KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3M3LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNy5hY2Nlc3NUb2tlbiwgY29udGVudCA9IF9yZWY3LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyBwb3N0Q29tbWVudCBuZWVkcyBpc3N1ZSBOb2RlSWQsIHNvIHdlIHN0b3JlIGl0IGludGVybmFsbHkKICAgICAgICAgICAgICAgICAgICBpc3N1ZU5vZGVJZDogdGhpcy5faXNzdWVOb2RlSWQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogIm11dGF0aW9uIHBvc3RDb21tZW50KFxuICAkaXNzdWVOb2RlSWQ6IElEIVxuICAkY29udGVudDogU3RyaW5nIVxuKSB7XG4gIGFkZENvbW1lbnQoXG4gICAgaW5wdXQ6IHtcbiAgICAgIHN1YmplY3RJZDogJGlzc3VlTm9kZUlkXG4gICAgICBib2R5OiAkY29udGVudFxuICAgIH1cbiAgKSB7XG4gICAgY29tbWVudEVkZ2Uge1xuICAgICAgbm9kZSB7XG4gICAgICAgIGlkXG4gICAgICAgIGJvZHlcbiAgICAgICAgYm9keUhUTUxcbiAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICBhdXRob3Ige1xuICAgICAgICAgIGF2YXRhclVybFxuICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgdXJsXG4gICAgICAgIH1cbiAgICAgICAgcmVhY3Rpb25Hcm91cHMge1xuICAgICAgICAgIHVzZXJzIChmaXJzdDogMCkge1xuICAgICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICAgIH1cbiAgICAgICAgICBjb250ZW50XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M3ID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zNy5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUNvbW1lbnQoZGF0YS5kYXRhLmFkZENvbW1lbnQuY29tbWVudEVkZ2Uubm9kZSkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0Q29tbWVudChfeDYpIHsKICAgICAgICByZXR1cm4gX3Bvc3RDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0Q29tbWVudDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBFZGl0IGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi91cGRhdGVpc3N1ZWNvbW1lbnQvCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvaW5wdXRfb2JqZWN0L3VwZGF0ZWlzc3VlY29tbWVudGlucHV0LwogICAgICovCgogIH0sIHsKICAgIGtleTogInB1dENvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wdXRDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOChfcmVmOCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3M4LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOC5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjguY29tbWVudElkLCBjb250ZW50ID0gX3JlZjguY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudElkLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJtdXRhdGlvbiBwdXRDb21tZW50KFxuICAkY29tbWVudElkOiBJRCEsXG4gICRjb250ZW50OiBTdHJpbmchLFxuKSB7XG4gIHVwZGF0ZUlzc3VlQ29tbWVudChpbnB1dDoge1xuICAgIGlkOiAkY29tbWVudElkXG4gICAgYm9keTogJGNvbnRlbnRcbiAgfSkge1xuICAgIGlzc3VlQ29tbWVudCB7XG4gICAgICBpZFxuICAgICAgYm9keVxuICAgICAgYm9keUhUTUxcbiAgICAgIGNyZWF0ZWRBdFxuICAgICAgdXBkYXRlZEF0XG4gICAgICBhdXRob3Ige1xuICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgbG9naW5cbiAgICAgICAgdXJsXG4gICAgICB9XG4gICAgICByZWFjdGlvbkdyb3VwcyB7XG4gICAgICAgIHVzZXJzIChmaXJzdDogMCkge1xuICAgICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgfVxuICAgICAgICBjb250ZW50XG4gICAgICB9XG4gICAgfVxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zOCA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczguZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVDb21tZW50KGRhdGEuZGF0YS51cGRhdGVJc3N1ZUNvbW1lbnQuaXNzdWVDb21tZW50KSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHB1dENvbW1lbnQoX3g3KSB7CiAgICAgICAgcmV0dXJuIF9wdXRDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwdXRDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vZGVsZXRlaXNzdWVjb21tZW50LwogICAgICovCgogIH0sIHsKICAgIGtleTogImRlbGV0ZUNvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kZWxldGVDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOShfcmVmOSkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY5LmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmOS5jb21tZW50SWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnRJZAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogIm11dGF0aW9uIGRlbGV0ZUNvbW1lbnQoXG4gICRjb21tZW50SWQ6IElEISxcbikge1xuICBkZWxldGVJc3N1ZUNvbW1lbnQoaW5wdXQ6IHtcbiAgICBpZDogJGNvbW1lbnRJZFxuICB9KSB7XG4gICAgY2xpZW50TXV0YXRpb25JZFxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHRydWUpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkZWxldGVDb21tZW50KF94OCkgewogICAgICAgIHJldHVybiBfZGVsZXRlQ29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZGVsZXRlQ29tbWVudDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgcmVhY3Rpb25zIG9mIGEgY29tbWVudAogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBUaGlzIHF1ZXJ5IGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZCwgdXNlIHRoZSBjb21tZW50cyBxdWVyeSBpbnN0ZWFkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29tbWVudFJlYWN0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldENvbW1lbnRSZWFjdGlvbnMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChfcmVmMTApIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIGNvbW1lbnRJZCwgX3RoaXMkX2dldFF1ZXJ5UGFyYW1zMiwgZmlyc3RPckxhc3QsIGFmdGVyT3JCZWZvcmUsIGN1cnNvciwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zOSwgZGF0YSwgY29tbWVudDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYxMC5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWYxMC5pc3N1ZUlkLCBjb21tZW50SWQgPSBfcmVmMTAuY29tbWVudElkOwogICAgICAgICAgICAgICAgX3RoaXMkX2dldFF1ZXJ5UGFyYW1zMiA9IHRoaXMuX2dldFF1ZXJ5UGFyYW1zKCksIGZpcnN0T3JMYXN0ID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zMi5maXJzdE9yTGFzdCwgYWZ0ZXJPckJlZm9yZSA9IF90aGlzJF9nZXRRdWVyeVBhcmFtczIuYWZ0ZXJPckJlZm9yZSwgY3Vyc29yID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zMi5jdXJzb3I7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgb3duZXI6IHRoaXMub3duZXIsCiAgICAgICAgICAgICAgICAgICAgcmVwbzogdGhpcy5yZXBvLAogICAgICAgICAgICAgICAgICAgIGlzc3VlSWQ6IGlzc3VlSWQsCiAgICAgICAgICAgICAgICAgICAgcGVyUGFnZTogdGhpcy5fcGFnZUluZm8ucGVyUGFnZQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogInF1ZXJ5IGdldENvbW1lbnRzKFxuICAkb3duZXI6IFN0cmluZyFcbiAgJHJlcG86IFN0cmluZyFcbiAgJGlzc3VlSWQ6IEludCFcbiAgJHBlclBhZ2U6IEludCFcbikge1xuICByZXBvc2l0b3J5KG93bmVyOiAkb3duZXIsIG5hbWU6ICRyZXBvKSB7XG4gICAgaXNzdWUobnVtYmVyOiAkaXNzdWVJZCkge1xuICAgICAgY29tbWVudHMoXG4gICAgICAgICIuY29uY2F0KGZpcnN0T3JMYXN0LCAiOiAkcGVyUGFnZVxuICAgICAgICAiKS5jb25jYXQoYWZ0ZXJPckJlZm9yZSA9PT0gbnVsbCA/ICcnIDogIiIuY29uY2F0KGFmdGVyT3JCZWZvcmUsICI6IFwiIikuY29uY2F0KGN1cnNvciwgIlwiIiksICJcbiAgICAgICkge1xuICAgICAgICBub2RlcyB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICByZWFjdGlvbkdyb3VwcyB7XG4gICAgICAgICAgICB1c2VycyAoZmlyc3Q6IDApIHtcbiAgICAgICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M5ID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczkuZGF0YTsKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBkYXRhLmRhdGEucmVwb3NpdG9yeS5pc3N1ZS5jb21tZW50cy5ub2Rlcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmlkID09PSBjb21tZW50SWQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplUmVhY3Rpb25zKGNvbW1lbnQucmVhY3Rpb25Hcm91cHMpKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTAsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50UmVhY3Rpb25zKF94OSkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudFJlYWN0aW9ucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Q29tbWVudFJlYWN0aW9uczsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcmVhY3Rpb24gb2YgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL2FkZHJlYWN0aW9uLwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L2lucHV0X29iamVjdC9hZGRyZWFjdGlvbmlucHV0LwogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RDb21tZW50UmVhY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0Q29tbWVudFJlYWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoX3JlZjExKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQsIHJlYWN0aW9uOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMTEuYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCA9IF9yZWYxMS5jb21tZW50SWQsIHJlYWN0aW9uID0gX3JlZjExLnJlYWN0aW9uOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudElkLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG1hcFJlYWN0aW9uTmFtZShyZWFjdGlvbikKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJtdXRhdGlvbiBwb3N0Q29tbWVudFJlYWN0aW9uKFxuICAkY29tbWVudElkOiBJRCEsXG4gICRjb250ZW50OiBSZWFjdGlvbkNvbnRlbnQhLFxuKSB7XG4gIGFkZFJlYWN0aW9uKGlucHV0OiB7XG4gICAgc3ViamVjdElkOiAkY29tbWVudElkXG4gICAgY29udGVudDogJGNvbnRlbnRcbiAgfSkge1xuICAgIHJlYWN0aW9uIHtcbiAgICAgIGRhdGFiYXNlSWRcbiAgICB9XG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHRydWUpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RDb21tZW50UmVhY3Rpb24oX3gxMCkgewogICAgICAgIHJldHVybiBfcG9zdENvbW1lbnRSZWFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbW1lbnRSZWFjdGlvbjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9nZXRRdWVyeVBhcmFtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFF1ZXJ5UGFyYW1zKCkgewogICAgICB2YXIgX3JlZjEyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwKICAgICAgICAgIF9yZWYxMiRwYWdlID0gX3JlZjEyLnBhZ2UsCiAgICAgICAgICBwYWdlID0gX3JlZjEyJHBhZ2UgPT09IHZvaWQgMCA/IHRoaXMuX3BhZ2VJbmZvLnBhZ2UgOiBfcmVmMTIkcGFnZSwKICAgICAgICAgIF9yZWYxMiRzb3J0ID0gX3JlZjEyLnNvcnQsCiAgICAgICAgICBzb3J0ID0gX3JlZjEyJHNvcnQgPT09IHZvaWQgMCA/IHRoaXMuX3BhZ2VJbmZvLnNvcnQgOiBfcmVmMTIkc29ydDsKCiAgICAgIHZhciBmaXJzdE9yTGFzdDsKICAgICAgdmFyIGFmdGVyT3JCZWZvcmU7CiAgICAgIHZhciBjdXJzb3I7CgogICAgICBpZiAocGFnZSA9PT0gMSkgewogICAgICAgIGZpcnN0T3JMYXN0ID0gc29ydCA9PT0gJ2FzYycgPyAnZmlyc3QnIDogJ2xhc3QnOwogICAgICAgIGFmdGVyT3JCZWZvcmUgPSBudWxsOwogICAgICAgIGN1cnNvciA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNvcnQgPT09ICdhc2MnKSB7CiAgICAgICAgICBpZiAocGFnZSA+IHRoaXMuX3BhZ2VJbmZvLnBhZ2UpIHsKICAgICAgICAgICAgZmlyc3RPckxhc3QgPSAnZmlyc3QnOwogICAgICAgICAgICBhZnRlck9yQmVmb3JlID0gJ2FmdGVyJzsKICAgICAgICAgICAgY3Vyc29yID0gdGhpcy5fcGFnZUluZm8uZW5kQ3Vyc29yOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlyc3RPckxhc3QgPSAnbGFzdCc7CiAgICAgICAgICAgIGFmdGVyT3JCZWZvcmUgPSAnYmVmb3JlJzsKICAgICAgICAgICAgY3Vyc29yID0gdGhpcy5fcGFnZUluZm8uc3RhcnRDdXJzb3I7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYWdlID4gdGhpcy5fcGFnZUluZm8ucGFnZSkgewogICAgICAgICAgICBmaXJzdE9yTGFzdCA9ICdsYXN0JzsKICAgICAgICAgICAgYWZ0ZXJPckJlZm9yZSA9ICdiZWZvcmUnOwogICAgICAgICAgICBjdXJzb3IgPSB0aGlzLl9wYWdlSW5mby5zdGFydEN1cnNvcjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpcnN0T3JMYXN0ID0gJ2ZpcnN0JzsKICAgICAgICAgICAgYWZ0ZXJPckJlZm9yZSA9ICdhZnRlcic7CiAgICAgICAgICAgIGN1cnNvciA9IHRoaXMuX3BhZ2VJbmZvLmVuZEN1cnNvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZmlyc3RPckxhc3Q6IGZpcnN0T3JMYXN0LAogICAgICAgIGFmdGVyT3JCZWZvcmU6IGFmdGVyT3JCZWZvcmUsCiAgICAgICAgY3Vyc29yOiBjdXJzb3IKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwbGF0Zm9ybSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnR2l0SHViJywKICAgICAgICBsaW5rOiB0aGlzLmJhc2VVUkwsCiAgICAgICAgdmVyc2lvbjogJ3Y0JywKICAgICAgICBtZXRhOiB7CiAgICAgICAgICByZWFjdGFibGU6IHRydWUsCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9XSk7CgogIHJldHVybiBHaXRodWJWNDsKfSgpOwoKZXhwb3J0IHsgR2l0aHViVjQgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * Github GraphQL API v4\n *\n * @see https://developer.github.com/v4/\n * @see https://developer.github.com/v4/explorer/\n * @see https://developer.github.com/apps/building-oauth-apps/\n */\nexport default class GithubV4 {\n    constructor({ baseURL = 'https://github.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for GitHub V4');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this._pageInfo = {\n            page: 1,\n            startCursor: null,\n            endCursor: null,\n            sort: null,\n            perPage: null,\n        };\n        this._issueNodeId = null;\n        this.$http = axios.create({\n            baseURL: baseURL === 'https://github.com'\n                ? 'https://api.github.com'\n                : concatURL(baseURL, 'api'),\n            headers: {\n                Accept: 'application/vnd.github.v3+json',\n            },\n        });\n        this.$http.interceptors.response.use(response => {\n            if (response.data.error) {\n                return Promise.reject(response.data.error_description);\n            }\n            if (response.data.errors) {\n                return Promise.reject(response.data.errors[0].message);\n            }\n            return response;\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitHub',\n            link: this.baseURL,\n            version: 'v4',\n            meta: {\n                reactable: true,\n                sortable: true,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#1-request-a-users-github-identity\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'login/oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'public_repo',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github\n     */\n    async getAccessToken({ code }) {\n        /**\n         * access_token api does not support cors\n         * @see https://github.com/isaacs/github/issues/330\n         */\n        const originalURL = concatURL(this.baseURL, 'login/oauth/access_token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }, {\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://developer.github.com/v4/query/ viewer\n     * @see https://developer.github.com/v4/object/user/\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.post('graphql', {\n            query: `\\\nquery getUser {\n  viewer {\n    login\n    avatarUrl\n    url\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeUser(data.data.viewer);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://developer.github.com/v4/object/repository/\n     * @see https://developer.github.com/v4/object/issueconnection/\n     * @see https://developer.github.com/v4/object/issue/\n     *\n     * @remarks\n     * The IssueConnection does not have title filter for now, and the number of results is limited to 100.\n     * For now, if issues with the labels are more than 100, we have to request the next page(not implemented yet).\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                const { data } = await this.$http.post(`graphql`, {\n                    query: `\\\nquery getIssueById {\n  repository(owner: \"${this.owner}\", name: \"${this.repo}\") {\n    issue (number: ${issueId}) {\n      id\n      number\n      title\n      body\n      url\n    }\n  }\n}`,\n                }, options);\n                // postComment needs issue NodeId, so we store it internally\n                this._issueNodeId = data.data.repository.issue.id;\n                return normalizeIssue(data.data.repository.issue);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            const query = [\n                `\"${issueTitle}\"`,\n                `in:title`,\n                `repo:${this.owner}/${this.repo}`,\n                `is:public`,\n                ...this.labels.map(label => `label:${label}`),\n            ].join(' ');\n            const { data } = await this.$http.post(`graphql`, {\n                variables: {\n                    query,\n                },\n                query: `\\\nquery getIssueByTitle(\n  $query: String!\n) {\n  search(\n    query: $query\n    type: ISSUE\n    first: 20\n    ) {\n      nodes {\n      ... on Issue {\n        id\n        number\n        title\n        body\n        url\n      }\n    }\n  }\n}`,\n            }, options);\n            const issue = data.data.search.nodes.find(item => item.title === issueTitle);\n            // postComment needs issue NodeId, so we store it internally\n            if (issue) {\n                this._issueNodeId = issue.id;\n                return normalizeIssue(issue);\n            }\n            return null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://developer.github.com/v4/mutation/createissue/\n     * @see https://developer.github.com/v4/input_object/createissueinput/\n     *\n     * @remarks\n     * Creating issue requires repositoryId, which should be requested in an extra request.\n     * Creating issue with labels requires labelIds, which should be requested in an extra request, or create the label if it does not exist.\n     * Endpoints for creating labels has not been implemented by GitHub yet (see https://developer.github.com/v4/mutation/createlabel/)\n     *\n     * For these reasons, fallback to v3 for now\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues`, {\n            title,\n            body: content,\n            labels: this.labels,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        // `html_url` in v3\n        // `url` in v4\n        data.url = data.html_url;\n        // postComment needs issue NodeId, so we store it internally\n        this._issueNodeId = data.node_id;\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://developer.github.com/v4/object/issuecommentconnection/\n     *\n     * @remarks\n     * No offset implemented, so it's difficult to implement REST-like pagination\n     * For now, we use an internal `_pageInfo` var to hack that\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10, sort = 'desc' } = {}, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (this._pageInfo.sort !== null && sort !== this._pageInfo.sort) {\n            page = 1;\n        }\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams({\n            page,\n            sort,\n        });\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        totalCount\n        pageInfo {\n          endCursor\n          startCursor\n        }\n        nodes {\n          id\n          body\n          bodyHTML\n          createdAt\n          updatedAt\n          author {\n            avatarUrl\n            login\n            url\n          }\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, options);\n        const comments = data.data.repository.issue.comments;\n        if (sort === 'desc') {\n            comments.nodes.reverse();\n        }\n        this._pageInfo = {\n            page,\n            startCursor: comments.pageInfo.startCursor,\n            endCursor: comments.pageInfo.endCursor,\n            sort,\n            perPage,\n        };\n        return {\n            count: comments.totalCount,\n            page: page,\n            perPage: perPage,\n            data: comments.nodes.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://developer.github.com/v4/mutation/addcomment/\n     * @see https://developer.github.com/v4/input_object/addcommentinput/\n     */\n    async postComment({ accessToken, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                // postComment needs issue NodeId, so we store it internally\n                issueNodeId: this._issueNodeId,\n                content,\n            },\n            query: `\\\nmutation postComment(\n  $issueNodeId: ID!\n  $content: String!\n) {\n  addComment(\n    input: {\n      subjectId: $issueNodeId\n      body: $content\n    }\n  ) {\n    commentEdge {\n      node {\n        id\n        body\n        bodyHTML\n        createdAt\n        updatedAt\n        author {\n          avatarUrl\n          login\n          url\n        }\n        reactionGroups {\n          users (first: 0) {\n            totalCount\n          }\n          content\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.addComment.commentEdge.node);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://developer.github.com/v4/mutation/updateissuecomment/\n     * @see https://developer.github.com/v4/input_object/updateissuecommentinput/\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content,\n            },\n            query: `\\\nmutation putComment(\n  $commentId: ID!,\n  $content: String!,\n) {\n  updateIssueComment(input: {\n    id: $commentId\n    body: $content\n  }) {\n    issueComment {\n      id\n      body\n      bodyHTML\n      createdAt\n      updatedAt\n      author {\n        avatarUrl\n        login\n        url\n      }\n      reactionGroups {\n        users (first: 0) {\n          totalCount\n        }\n        content\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.updateIssueComment.issueComment);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v4/mutation/deleteissuecomment/\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n            },\n            query: `\\\nmutation deleteComment(\n  $commentId: ID!,\n) {\n  deleteIssueComment(input: {\n    id: $commentId\n  }) {\n    clientMutationId\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return true;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @remarks\n     * This query has not been implemented, use the comments query instead\n     */\n    async getCommentReactions({ accessToken, issueId, commentId, }) {\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams();\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage: this._pageInfo.perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        nodes {\n          id\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        const comment = data.data.repository.issue.comments.nodes.find(item => item.id === commentId);\n        return normalizeReactions(comment.reactionGroups);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://developer.github.com/v4/mutation/addreaction/\n     * @see https://developer.github.com/v4/input_object/addreactioninput/\n     */\n    async postCommentReaction({ accessToken, commentId, reaction, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content: mapReactionName(reaction),\n            },\n            query: `\\\nmutation postCommentReaction(\n  $commentId: ID!,\n  $content: ReactionContent!,\n) {\n  addReaction(input: {\n    subjectId: $commentId\n    content: $content\n  }) {\n    reaction {\n      databaseId\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return true;\n    }\n    _getQueryParams({ page = this._pageInfo.page, sort = this._pageInfo.sort, } = {}) {\n        let firstOrLast;\n        let afterOrBefore;\n        let cursor;\n        if (page === 1) {\n            firstOrLast = sort === 'asc' ? 'first' : 'last';\n            afterOrBefore = null;\n            cursor = null;\n        }\n        else {\n            if (sort === 'asc') {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n                else {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n            }\n            else {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n                else {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n            }\n        }\n        return {\n            firstOrLast,\n            afterOrBefore,\n            cursor,\n        };\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}